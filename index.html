    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>EduQuest – Gamified STEM Learning</title>
        <link rel="stylesheet" href="style.css">
        <link rel="manifest" href="manifest.json">
        <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    </head>
    <body>
        <!-- Language Selection Screen -->
        <div id="language-screen" class="screen">
            <div class="container">
                <div class="header">
                    <img src="https://placeholder-image-service.onrender.com/image/200x100?prompt=bright%20educational%20logo%20with%20stars%20and%20science%20symbols&id=lang-logo-1" alt="EduQuest logo with stars and science symbols" class="logo">
                    <h1>EduQuest</h1>
                    <p class="subtitle">Gamified STEM Learning</p>
                </div>
                
                <div class="language-selection">
                    <h2>Choose Your Language</h2>
                    <div class="language-options">
                        <button class="language-btn" data-lang="en">
                            <img src="https://placeholder-image-service.onrender.com/image/80x80?prompt=British%20flag%20icon&id=lang-en-1" alt="British flag representing English language">
                            <span>English</span>
                        </button>
                        <button class="language-btn" data-lang="hi">
                            <img src="https://placeholder-image-service.onrender.com/image/80x80?prompt=India%20flag%20icon&id=lang-hi-1" alt="Hindi language">
                            <span>हिन्दी</span>
                        </button>
                        <button class="language-btn" data-lang="od">
                            <img src="https://placeholder-image-service.onrender.com/image/80x80?prompt=India%20flag%20icon&id=lang-od-1" alt="Odia language">
                            <span>ଓଡ଼ିଆ</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Screen -->
        <div id="dashboard-screen" class="screen">
            <header class="app-header">
                <div class="header-content">
                    <button id="menu-btn" class="icon-btn">
                        <img src="https://placeholder-image-service.onrender.com/image/30x30?prompt=hamburger%20menu%20icon&id=menu-icon-1" alt="Navigation menu">
                    </button>
                    <h1>EduQuest</h1>
                    <button id="login-btn" class="icon-btn" title="Login">
                        <img src="https://img.icons8.com/fluency-systems-regular/30/login-rounded-right.png" alt="Login">
                    </button>
                    <button id="profile-btn" class="icon-btn">
                        <img src="https://placeholder-image-service.onrender.com/image/30x30?prompt=user%20profile%20icon&id=profile-icon-1" alt="User profile">
                    </button>
                </div>
            </header>

            <main class="dashboard-content">
                <!-- User Progress Section -->
                <section class="progress-section">
                    <div class="welcome-banner">
                        <h2>Hello, <span id="username">Student</span>!</h2>
                        <div class="progress-stats">
                            <div class="stat">
                                <span class="stat-value" id="total-points">0</span>
                                <span class="stat-label">Points</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="badges-count">0</span>
                                <span class="stat-label">Badges</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="lessons-completed">0</span>
                                <span class="stat-label">Lessons</span>
                            </div>
                        </div>
                    </div>

                    <div class="badges-display">
                        <h3>Your Badges</h3>
                        <div class="badges-grid">
                            <div class="badge locked">
                                <img src="https://placeholder-image-service.onrender.com/image/70x70?prompt=math%20whiz%20badge%20with%20calculator%20and%20stars&id=badge-math-1" alt="Math Whiz badge with calculator and stars">
                                <span>Math Whiz</span>
                            </div>
                            <div class="badge locked">
                                <img src="https://placeholder-image-service.onrender.com/image/70x70?prompt=science%20explorer%20badge%20with%20microscope&id=badge-science-1" alt="Science Explorer badge with microscope">
                                <span>Science Explorer</span>
                            </div>
                            <div class="badge locked">
                                <img src="https://placeholder-image-service.onrender.com/image/70x70?prompt=technology%20master%20badge%20with%20circuit%20board&id=badge-tech-1" alt="Technology Master badge with circuit board">
                                <span>Tech Master</span>
                            </div>
                            <div class="badge locked">
                                <img src="https://placeholder-image-service.onrender.com/image/70x70?prompt=engineering%20builder%20badge%20with%20gears&id=badge-eng-1" alt="Engineering Builder badge with gears">
                                <span>Engineering Builder</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Student Portal: Progress & Goals -->
                <section class="materials-section" id="student-portal" style="margin-top: 10px;">
                    <div class="section-header">
                        <h3>My Learning Overview</h3>
                    </div>
                    <div class="materials-grid" style="grid-template-columns: 1fr;">
                        <div class="material-card" style="flex-direction: column;">
                            <h4 style="margin-bottom:10px;">Subject Progress</h4>
                            <canvas id="student-progress-chart" height="140"></canvas>
                        </div>
                        <div class="material-card" style="flex-direction: column;">
                            <h4 style="margin-bottom:10px;">Daily Goal</h4>
                            <div id="daily-goal">
                                <p><strong id="goal-text">Solve 5 problems today</strong></p>
                                <div class="progress-bar" style="margin-top:8px;">
                                    <div class="progress-fill" id="daily-goal-fill" style="width: 0%"></div>
                                </div>
                                <p style="margin-top:8px;">Completed: <span id="daily-goal-done">0</span>/<span id="daily-goal-target">5</span></p>
                            </div>
                        </div>
                        <div class="material-card" style="flex-direction: column;">
                            <h4 style="margin-bottom:10px;">Recent Activity</h4>
                            <ul id="recent-activity" style="list-style:none; padding-left:0; margin:0; max-height:180px; overflow:auto;"></ul>
                        </div>
                        <div class="material-card" style="flex-direction: column;">
                            <h4 style="margin-bottom:10px;">Announcements</h4>
                            <ul id="student-announcements" style="list-style:none; padding-left:0; margin:0; max-height:180px; overflow:auto;"></ul>
                        </div>
                    </div>
                </section>

                <!-- Learning Materials Section -->
                <section class="materials-section">
                    <div class="section-header">
                        <h3>Learning Materials</h3>
                        <button id="upload-btn" class="primary-btn">
                            <img src="https://placeholder-image-service.onrender.com/image/20x20?prompt=upload%20icon&id=upload-icon-1" alt="Upload materials">
                            Upload
                        </button>
                    </div>
                    
                    <div class="materials-grid">
                        <div class="material-card">
                            <div class="material-thumbnail">
                                <img src="https://placeholder-image-service.onrender.com/image/120x120?prompt=math%20textbook%20cover%20with%20numbers%20and%20formulas&id=material-math-1" alt="Mathematics textbook cover">
                            </div>
                            <div class="material-info">
                                <h4>Mathematics Basics</h4>
                                <p>Algebra and Geometry fundamentals</p>
                                <div class="material-meta">
                                    <span class="file-type">PDF</span>
                                    <span class="file-size">2.4 MB</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="material-card">
                            <div class="material-thumbnail">
                                <img src="https://placeholder-image-service.onrender.com/image/120x120?prompt=science%20book%20cover%20with%20atom%20diagram&id=material-science-1" alt="Science textbook cover">
                            </div>
                            <div class="material-info">
                                <h4>Science Wonders</h4>
                                <p>Physics and Chemistry experiments</p>
                                <div class="material-meta">
                                    <span class="file-type">PDF</span>
                                    <span class="file-size">3.1 MB</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Lessons Section -->
                <section class="lessons-section">
                    <h3>STEM Lessons</h3>
                    <div class="lessons-grid">
                        <div class="lesson-card" data-lesson="math">
                            <div class="lesson-icon">
                                <img src="https://placeholder-image-service.onrender.com/image/60x60?prompt=math%20lesson%20icon%20with%20calculator&id=lesson-math-1" alt="Mathematics lesson icon">
                            </div>
                            <div class="lesson-info">
                                <h4>Mathematics Puzzle</h4>
                                <p>Solve equations and unlock rewards</p>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <button class="start-lesson-btn">Start</button>
                        </div>
                        
                        <div class="lesson-card" data-lesson="memory">
                            <div class="lesson-icon">
                                <img src="https://placeholder-image-service.onrender.com/image/60x60?prompt=memory%20cards%20icon%20with%20brain&id=lesson-memory-1" alt="Memory matching lesson icon">
                            </div>
                            <div class="lesson-info">
                                <h4>Memory Match</h4>
                                <p>Match vocabulary words with their meanings</p>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <button class="start-lesson-btn">Start</button>
                        </div>
                        
                        <div class="lesson-card" data-lesson="science">
                            <div class="lesson-icon">
                                <img src="https://placeholder-image-service.onrender.com/image/60x60?prompt=science%20lesson%20icon%20with%20flask&id=lesson-science-1" alt="Science lesson icon">
                            </div>
                            <div class="lesson-info">
                                <h4>Science Quiz</h4>
                                <p>Test your knowledge of scientific concepts</p>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            <button class="start-lesson-btn">Start</button>
                        </div>
                    </div>
                </section>
            </main>

            <!-- Upload Modal -->
            <div id="upload-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Upload Learning Material</h3>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="upload-area" id="drop-zone">
                            <img src="https://placeholder-image-service.onrender.com/image/80x80?prompt=upload%20file%20icon&id=upload-area-icon-1" alt="File upload icon">
                            <p>Drag & drop files here or click to browse</p>
                            <input type="file" id="file-input" hidden accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.jpg,.png">
                        </div>
                        <div class="upload-preview" id="upload-preview" style="display: none;">
                            <div class="preview-item">
                                <img src="https://placeholder-image-service.onrender.com/image/50x50?prompt=document%20icon&id=preview-doc-1" alt="Document preview">
                                <div class="preview-info">
                                    <span class="file-name">document.pdf</span>
                                    <span class="file-size">2.4 MB</span>
                                </div>
                                <button class="remove-file">&times;</button>
                            </div>
                        </div>
                        <div class="upload-actions">
                            <button class="secondary-btn" id="cancel-upload">Cancel</button>
                            <button class="primary-btn" id="confirm-upload" disabled>Upload</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <button id="back-to-dashboard" class="icon-btn">
                    <img src="https://placeholder-image-service.onrender.com/image/30x30?prompt=back%20arrow%20icon&id=back-icon-1" alt="Back to dashboard">
                </button>
                <div class="game-stats">
                    <span class="points">Points: <span id="game-points">0</span></span>
                    <span class="timer">Time: <span id="game-timer">60</span>s</span>
                </div>
            </div>

            <div class="game-container">
                <h2 id="game-title">Math Puzzle Challenge</h2>
                <div id="game-content">
                    <div class="math-problem" id="math-game-section">
                        <p id="problem-text">Solve the equation: 2x + 5 = 15</p>
                        <div class="answer-input">
                            <label for="math-answer">x = </label>
                            <input type="number" id="math-answer" step="any">
                        </div>
                        <button id="check-answer" class="primary-btn">Check Answer</button>
                    </div>
                    
                    <div class="feedback-message" id="feedback-message" style="display: none;">
                        <p id="feedback-text"></p>
                        <button id="next-problem" class="primary-btn">Next Problem</button>
                    </div>

                    <div id="memory-game-section" style="display: none;">
                        <div class="vocab-header">
                            <h3>VOCABULARY MATCHING</h3>
                        </div>
                        <div class="memory-stats">
                            <span>Moves: <strong id="memory-moves">0</strong></span>
                            <span>Matches: <strong id="memory-matches">0</strong>/10</span>
                        </div>
                        <div id="memory-grid" class="memory-grid" aria-label="Vocabulary matching cards" role="grid"></div>
                        <div class="feedback-message" id="memory-complete" style="display: none;">
                            <p id="memory-feedback-text">Great! You matched all pairs!</p>
                            <button id="memory-restart" class="primary-btn">Play Again</button>
                        </div>
                        <div id="match-checkmark" aria-hidden="true">✓</div>
                    </div>
                </div>
                
                <div class="game-progress">
                    <p>Problems solved: <span id="problems-solved">0</span>/5</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Drawer -->
        <div id="nav-drawer" class="drawer">
            <div class="drawer-content">
                <div class="drawer-header">
                    <img src="https://placeholder-image-service.onrender.com/image/60x60?prompt=student%20avatar&id=avatar-1" alt="Student avatar" class="user-avatar">
                    <div class="user-info">
                        <span id="drawer-username">Student</span>
                        <span class="user-level">Level 1 Explorer</span>
                    </div>
                </div>
                
                <nav class="drawer-nav">
                    <a href="#" class="nav-item active">
                        <img src="https://placeholder-image-service.onrender.com/image/24x24?prompt=home%20icon&id=nav-home-1" alt="Home">
                        <span>Dashboard</span>
                    </a>
                    <a href="dashboard.html" class="nav-item">
                        <img src="https://placeholder-image-service.onrender.com/image/24x24?prompt=teacher%20dashboard%20icon&id=nav-teacher-1" alt="Teacher dashboard">
                        <span>Teacher View</span>
                    </a>
                    <a href="#" class="nav-item">
                        <img src="https://placeholder-image-service.onrender.com/image/24x24?prompt=settings%20icon&id=nav-settings-1" alt="Settings">
                        <span>Settings</span>
                    </a>
                    <a href="#" class="nav-item" id="export-data">
                        <img src="https://placeholder-image-service.onrender.com/image/24x24?prompt=export%20icon&id=nav-export-1" alt="Export data">
                        <span>Export Progress</span>
                    </a>
                    <a href="#" class="nav-item" id="import-data">
                        <img src="https://placeholder-image-service.onrender.com/image/24x24?prompt=import%20icon&id=nav-import-1" alt="Import data">
                        <span>Import Progress</span>
                    </a>
                </nav>
                
                <div class="drawer-footer">
                    <button id="logout-btn" class="secondary-btn">Log Out</button>
                </div>
            </div>
        </div>

        <script src="game.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Register service worker for PWA functionality
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('service-worker.js')
                        .then(function(registration) {
                            console.log('ServiceWorker registration successful with scope: ', registration.scope);
                        })
                        .catch(function(error) {
                            console.log('ServiceWorker registration failed: ', error);
                        });
                });
            }

            // DOM elements
            const languageScreen = document.getElementById('language-screen');
            const dashboardScreen = document.getElementById('dashboard-screen');
            const gameScreen = document.getElementById('game-screen');
            const languageButtons = document.querySelectorAll('.language-btn');
            const menuBtn = document.getElementById('menu-btn');
            const navDrawer = document.getElementById('nav-drawer');
            const uploadBtn = document.getElementById('upload-btn');
            const uploadModal = document.getElementById('upload-modal');
            const closeModalBtn = document.querySelector('.close-modal');
            const cancelUploadBtn = document.getElementById('cancel-upload');
            const fileInput = document.getElementById('file-input');
            const dropZone = document.getElementById('drop-zone');
            const startLessonBtns = document.querySelectorAll('.start-lesson-btn');
            const backToDashboardBtn = document.getElementById('back-to-dashboard');
            const checkAnswerBtn = document.getElementById('check-answer');
            const nextProblemBtn = document.getElementById('next-problem');
            const mathAnswerInput = document.getElementById('math-answer');
            const feedbackMessage = document.getElementById('feedback-message');
            
            // User data
            let userData = {
                username: 'Student',
                language: 'en',
                points: 0,
                badges: [],
                lessonsCompleted: 0,
                mathProgress: 0,
                scienceProgress: 0,
                memoryProgress: 0
            };

            // Translations (EN, HI, OD)
            const translations = {
                en: {
                    appTitle: 'EduQuest',
                    subtitle: 'Gamified STEM Learning',
                    chooseLanguage: 'Choose Your Language',
                    welcome: 'Hello',
                    points: 'Points',
                    badges: 'Badges',
                    lessons: 'Lessons',
                    learningMaterials: 'Learning Materials',
                    upload: 'Upload',
                    stemLessons: 'STEM Lessons',
                    mathTitle: 'Mathematics Puzzle',
                    mathDesc: 'Solve equations and unlock rewards',
                    scienceTitle: 'Science Quiz',
                    scienceDesc: 'Test your knowledge of scientific concepts',
                    start: 'Start',
                    dashboard: 'Dashboard',
                    teacherView: 'Teacher View',
                    settings: 'Settings',
                    export: 'Export Progress',
                    import: 'Import Progress',
                    logout: 'Log Out',
                    back: 'Back to dashboard',
                    memoryTitle: 'Memory Match – Vocabulary'
                },
                hi: {
                    appTitle: 'EduQuest',
                    subtitle: 'खेल-आधारित STEM शिक्षा',
                    chooseLanguage: 'अपनी भाषा चुनें',
                    welcome: 'नमस्ते',
                    points: 'अंक',
                    badges: 'बैज',
                    lessons: 'पाठ',
                    learningMaterials: 'अध्ययन सामग्री',
                    upload: 'अपलोड',
                    stemLessons: 'एसटीईएम पाठ',
                    mathTitle: 'गणित पहेली',
                    mathDesc: 'समाधान करें और पुरस्कार पाएं',
                    scienceTitle: 'विज्ञान प्रश्नोत्तरी',
                    scienceDesc: 'वैज्ञानिक ज्ञान परखें',
                    start: 'शुरू करें',
                    dashboard: 'डैशबोर्ड',
                    teacherView: 'शिक्षक दृश्य',
                    settings: 'सेटिंग्स',
                    export: 'प्रगति निर्यात करें',
                    import: 'प्रगति आयात करें',
                    logout: 'लॉग आउट',
                    back: 'डैशबोर्ड पर वापस',
                    memoryTitle: 'शब्दार्थ मिलान – शब्दावली'
                },
                od: {
                    appTitle: 'EduQuest',
                    subtitle: 'ଖେଳ ଆଧାରିତ STEM ଶିକ୍ଷା',
                    chooseLanguage: 'ଆପଣଙ୍କ ଭାଷା ବାଛନ୍ତୁ',
                    welcome: 'ନମସ୍କାର',
                    points: 'ପଏଣ୍ଟ',
                    badges: 'ବ୍ୟାଜ୍',
                    lessons: 'ପାଠ',
                    learningMaterials: 'ଅଧ୍ୟୟନ ସାମଗ୍ରୀ',
                    upload: 'ଅପଲୋଡ୍',
                    stemLessons: 'STEM ପାଠ',
                    mathTitle: 'ଗଣିତ ପଜଲ୍',
                    mathDesc: 'ସମୀକରଣ ସମାଧାନ କରନ୍ତୁ',
                    scienceTitle: 'ବିଜ୍ଞାନ କ୍ୱିଜ୍',
                    scienceDesc: 'ବିଜ୍ଞାନ ଜ୍ଞାନ ପରୀକ୍ଷା',
                    start: 'ଆରମ୍ଭ',
                    dashboard: 'ଡ୍ୟାଶବୋର୍ଡ',
                    teacherView: 'ଶିକ୍ଷକ ଦୃଶ୍ୟ',
                    settings: 'ସେଟିଙ୍ଗ୍ସ',
                    export: 'ପ୍ରଗତି ଏକ୍ସପୋର୍ଟ',
                    import: 'ପ୍ରଗତି ଇମ୍ପୋର୍ଟ',
                    logout: 'ଲଗ୍ ଆଉଟ୍',
                    back: 'ଡ୍ୟାଶବୋର୍ଡକୁ ଫେରନ୍ତୁ',
                    memoryTitle: 'ଶବ୍ଦ ମେଳ – ଶବ୍ଦାବଳୀ'
                }
            };

            // Localized icon map (swapable per language)
            const iconMap = {
                en: {
                    logo: 'https://placeholder-image-service.onrender.com/image/200x100?prompt=bright%20educational%20logo%20with%20stars%20and%20science%20symbols&id=lang-logo-1',
                    menu: 'https://placeholder-image-service.onrender.com/image/30x30?prompt=hamburger%20menu%20icon&id=menu-icon-1',
                    profile: 'https://placeholder-image-service.onrender.com/image/30x30?prompt=user%20profile%20icon&id=profile-icon-1',
                    lessonMath: 'https://placeholder-image-service.onrender.com/image/60x60?prompt=math%20lesson%20icon%20with%20calculator&id=lesson-math-1',
                    lessonScience: 'https://placeholder-image-service.onrender.com/image/60x60?prompt=science%20lesson%20icon%20with%20flask&id=lesson-science-1',
                    lessonMemory: 'https://placeholder-image-service.onrender.com/image/60x60?prompt=memory%20cards%20icon%20with%20brain&id=lesson-memory-1',
                    upload: 'https://placeholder-image-service.onrender.com/image/20x20?prompt=upload%20icon&id=upload-icon-1',
                    navHome: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=home%20icon&id=nav-home-1',
                    navTeacher: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=teacher%20dashboard%20icon&id=nav-teacher-1',
                    navSettings: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=settings%20icon&id=nav-settings-1',
                    navExport: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=export%20icon&id=nav-export-1',
                    navImport: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=import%20icon&id=nav-import-1',
                    back: 'https://placeholder-image-service.onrender.com/image/30x30?prompt=back%20arrow%20icon&id=back-icon-1'
                },
                hi: {
                    logo: 'https://placeholder-image-service.onrender.com/image/200x100?prompt=उज्ज्वल%20शैक्षिक%20लोगो%20सितारों%20और%20विज्ञान%20प्रतीकों%20के%20साथ&id=lang-logo-hi',
                    menu: 'https://placeholder-image-service.onrender.com/image/30x30?prompt=मेनू%20आइकन&id=menu-icon-hi',
                    profile: 'https://placeholder-image-service.onrender.com/image/30x30?prompt=प्रोफ़ाइल%20आइकन&id=profile-icon-hi',
                    lessonMath: 'https://placeholder-image-service.onrender.com/image/60x60?prompt=कैलकुलेटर%20आइकन%20के%20साथ%20गणित&id=lesson-math-hi',
                    lessonScience: 'https://placeholder-image-service.onrender.com/image/60x60?prompt=फ्लास्क%20आइकन%20के%20साथ%20विज्ञान&id=lesson-science-hi',
                    lessonMemory: 'https://placeholder-image-service.onrender.com/image/60x60?prompt=मेमोरी%20कार्ड%20आइकन%20मस्तिष्क%20के%20साथ&id=lesson-memory-hi',
                    upload: 'https://placeholder-image-service.onrender.com/image/20x20?prompt=अपलोड%20आइकन&id=upload-icon-hi',
                    navHome: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=होम%20आइकन&id=nav-home-hi',
                    navTeacher: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=शिक्षक%20डैशबोर्ड%20आइकन&id=nav-teacher-hi',
                    navSettings: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=सेटिंग्स%20आइकन&id=nav-settings-hi',
                    navExport: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=निर्यात%20आइकन&id=nav-export-hi',
                    navImport: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=आयात%20आइकन&id=nav-import-hi',
                    back: 'https://placeholder-image-service.onrender.com/image/30x30?prompt=पीछे%20तीर%20आइकन&id=back-icon-hi'
                },
                od: {
                    logo: 'https://placeholder-image-service.onrender.com/image/200x100?prompt=ଆଲୋକିତ%20ଶିକ୍ଷାଗତ%20ଲୋଗୋ%20ତାରା%20ଏବଂ%20ବିଜ୍ଞାନ%20ଚିହ୍ନ%20ସହିତ&id=lang-logo-od',
                    menu: 'https://placeholder-image-service.onrender.com/image/30x30?prompt=ମେନୁ%20ଆଇକନ&id=menu-icon-od',
                    profile: 'https://placeholder-image-service.onrender.com/image/30x30?prompt=ପ୍ରୋଫାଇଲ୍%20ଆଇକନ&id=profile-icon-od',
                    lessonMath: 'https://placeholder-image-service.onrender.com/image/60x60?prompt=କ୍ୟାଲକୁଲେଟର%20ଆଇକନ%20ସହିତ%20ଗଣିତ&id=lesson-math-od',
                    lessonScience: 'https://placeholder-image-service.onrender.com/image/60x60?prompt=ଫ୍ଲାସ୍କ%20ଆଇକନ୍%20ସହିତ%20ବିଜ୍ଞାନ&id=lesson-science-od',
                    lessonMemory: 'https://placeholder-image-service.onrender.com/image/60x60?prompt=ସ୍ମୃତି%20କାର୍ଡ%20ଆଇକନ୍%20ମସ୍ତିଷ୍କ%20ସହିତ&id=lesson-memory-od',
                    upload: 'https://placeholder-image-service.onrender.com/image/20x20?prompt=ଅପଲୋଡ୍%20ଆଇକନ&id=upload-icon-od',
                    navHome: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=ହୋମ୍%20ଆଇକନ&id=nav-home-od',
                    navTeacher: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=ଶିକ୍ଷକ%20ଡ୍ୟାଶବୋର୍ଡ%20ଆଇକନ&id=nav-teacher-od',
                    navSettings: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=ସେଟିଙ୍ଗ୍ସ%20ଆଇକନ&id=nav-settings-od',
                    navExport: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=ଏକ୍ସପୋର୍ଟ%20ଆଇକନ&id=nav-export-od',
                    navImport: 'https://placeholder-image-service.onrender.com/image/24x24?prompt=ଇମ୍ପୋର୍ଟ%20ଆଇକନ&id=nav-import-od',
                    back: 'https://placeholder-image-service.onrender.com/image/30x30?prompt=ପଛକୁ%20ତୀର%20ଆଇକନ&id=back-icon-od'
                }
            };

            // Initialize app
            function initApp() {
                // Load user data from localStorage if available
                const savedData = localStorage.getItem('eduquest_user');
                if (savedData) {
                    userData = JSON.parse(savedData);
                }
                // Show dashboard on front page by default
                languageScreen.classList.remove('active');
                dashboardScreen.classList.add('active');
                
                // Set up event listeners
                setupEventListeners();

                // Apply language on load
                applyLanguage();

                // Ensure role-based UI toggles reflect stored role
                updateDashboard();

                // Initialize student portal UI
                initStudentPortal();
            }

            // Set up all event listeners
            function setupEventListeners() {
                // Language selection
                languageButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        userData.language = btn.dataset.lang;
                        languageScreen.classList.remove('active');
                        dashboardScreen.classList.add('active');
                        saveUserData();
                        applyLanguage();
                    });
                });

                // Menu button
                menuBtn.addEventListener('click', () => {
                    navDrawer.classList.toggle('open');
                });

                // Close drawer when clicking outside
                document.addEventListener('click', (e) => {
                    if (navDrawer.classList.contains('open') && 
                        !navDrawer.contains(e.target) && 
                        e.target !== menuBtn) {
                        navDrawer.classList.remove('open');
                    }
                });

                // Upload functionality
                uploadBtn.addEventListener('click', () => {
                    uploadModal.style.display = 'block';
                });

                // Go to login page
                const loginBtn = document.getElementById('login-btn');
                if (loginBtn) {
                    loginBtn.addEventListener('click', () => {
                        window.location.href = 'login.html';
                    });
                }

                closeModalBtn.addEventListener('click', closeUploadModal);
                cancelUploadBtn.addEventListener('click', closeUploadModal);

                // File upload handling
                dropZone.addEventListener('click', () => {
                    fileInput.click();
                });

                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('dragover');
                });

                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('dragover');
                });

                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('dragover');
                    handleFiles(e.dataTransfer.files);
                });

                fileInput.addEventListener('change', () => {
                    handleFiles(fileInput.files);
                });

                // Lesson start buttons
                startLessonBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const lessonType = btn.closest('.lesson-card').dataset.lesson;
                        startLesson(lessonType);
                    });
                });

                // Back to dashboard from game
                backToDashboardBtn.addEventListener('click', () => {
                    gameScreen.classList.remove('active');
                    dashboardScreen.classList.add('active');
                });

                // Game functionality
                checkAnswerBtn.addEventListener('click', checkMathAnswer);
                nextProblemBtn.addEventListener('click', generateMathProblem);
                mathAnswerInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        checkMathAnswer();
                    }
                });

                // Export/Import data
                document.getElementById('export-data').addEventListener('click', exportUserData);
                document.getElementById('import-data').addEventListener('click', importUserData);
            }

            // Apply translations and localized icons
            function applyLanguage() {
                const lang = userData.language || 'en';
                const t = translations[lang] || translations.en;
                const icons = iconMap[lang] || iconMap.en;

                // Language screen
                const titleEl = document.querySelector('#language-screen .header h1');
                if (titleEl) titleEl.textContent = t.appTitle;
                const subtitleEl = document.querySelector('#language-screen .subtitle');
                if (subtitleEl) subtitleEl.textContent = t.subtitle;
                const chooseEl = document.querySelector('#language-screen .language-selection h2, #language-screen h2');
                if (chooseEl) chooseEl.textContent = t.chooseLanguage;
                const logoEl = document.querySelector('#language-screen .logo');
                if (logoEl && icons.logo) logoEl.src = icons.logo;

                // App header
                const headerTitle = document.querySelector('#dashboard-screen .header-content h1');
                if (headerTitle) headerTitle.textContent = t.appTitle;
                const menuImg = document.querySelector('#menu-btn img');
                if (menuImg && icons.menu) menuImg.src = icons.menu;
                const profileImg = document.querySelector('#profile-btn img');
                if (profileImg && icons.profile) profileImg.src = icons.profile;

                // Welcome banner and stats labels
                const welcomeH2 = document.querySelector('.welcome-banner h2');
                if (welcomeH2) welcomeH2.innerHTML = `${t.welcome}, <span id="username">${userData.username}</span>!`;
                const statLabels = document.querySelectorAll('.progress-stats .stat .stat-label');
                if (statLabels && statLabels.length >= 3) {
                    statLabels[0].textContent = t.points;
                    statLabels[1].textContent = t.badges;
                    statLabels[2].textContent = t.lessons;
                }

                // Materials header and upload button text/icon
                const materialsHeader = document.querySelector('.materials-section .section-header h3');
                if (materialsHeader) materialsHeader.textContent = t.learningMaterials;
                const uploadBtnEl = document.getElementById('upload-btn');
                if (uploadBtnEl) {
                    const uploadImg = uploadBtnEl.querySelector('img');
                    if (uploadImg && icons.upload) uploadImg.src = icons.upload;
                    // set text node after img
                    const imgSibling = uploadImg && uploadImg.nextSibling;
                    if (imgSibling) imgSibling.textContent = ' ' + t.upload;
                }

                // Lessons section titles and icons
                const lessonsHeader = document.querySelector('.lessons-section h3');
                if (lessonsHeader) lessonsHeader.textContent = t.stemLessons;

                const mathCard = document.querySelector('[data-lesson="math"]');
                if (mathCard) {
                    const img = mathCard.querySelector('.lesson-icon img');
                    if (img && icons.lessonMath) img.src = icons.lessonMath;
                    const h4 = mathCard.querySelector('.lesson-info h4');
                    const p = mathCard.querySelector('.lesson-info p');
                    if (h4) h4.textContent = t.mathTitle;
                    if (p) p.textContent = t.mathDesc;
                    const btn = mathCard.querySelector('.start-lesson-btn');
                    if (btn) btn.textContent = t.start;
                }

                const memoryCard = document.querySelector('[data-lesson="memory"]');
                if (memoryCard) {
                    const img = memoryCard.querySelector('.lesson-icon img');
                    if (img && icons.lessonMemory) img.src = icons.lessonMemory;
                    const h4 = memoryCard.querySelector('.lesson-info h4');
                    if (h4) h4.textContent = t.memoryTitle;
                    const btn = memoryCard.querySelector('.start-lesson-btn');
                    if (btn) btn.textContent = t.start;
                }

                const sciCard = document.querySelector('[data-lesson="science"]');
                if (sciCard) {
                    const img = sciCard.querySelector('.lesson-icon img');
                    if (img && icons.lessonScience) img.src = icons.lessonScience;
                    const h4 = sciCard.querySelector('.lesson-info h4');
                    const p = sciCard.querySelector('.lesson-info p');
                    if (h4) h4.textContent = t.scienceTitle;
                    if (p) p.textContent = t.scienceDesc;
                    const btn = sciCard.querySelector('.start-lesson-btn');
                    if (btn) btn.textContent = t.start;
                }

                // Drawer labels and icons
                const drawer = document.getElementById('nav-drawer');
                if (drawer) {
                    const items = drawer.querySelectorAll('.drawer-nav .nav-item');
                    items.forEach(item => {
                        const span = item.querySelector('span');
                        const img = item.querySelector('img');
                        if (span) {
                            if (span.textContent.includes('Dashboard')) span.textContent = t.dashboard;
                            else if (span.textContent.includes('Teacher')) span.textContent = t.teacherView;
                            else if (span.textContent.includes('Settings')) span.textContent = t.settings;
                            else if (span.textContent.includes('Export')) span.textContent = t.export;
                            else if (span.textContent.includes('Import')) span.textContent = t.import;
                        }
                        if (img) {
                            if (img.alt.includes('Home') && icons.navHome) img.src = icons.navHome;
                            else if (img.alt.includes('Teacher') && icons.navTeacher) img.src = icons.navTeacher;
                            else if (img.alt.includes('Settings') && icons.navSettings) img.src = icons.navSettings;
                            else if (img.alt.includes('Export') && icons.navExport) img.src = icons.navExport;
                            else if (img.alt.includes('Import') && icons.navImport) img.src = icons.navImport;
                        }
                    });
                }

                // Back button icon and title
                const backBtn = document.getElementById('back-to-dashboard');
                if (backBtn) {
                    const img = backBtn.querySelector('img');
                    if (img && icons.back) img.src = icons.back;
                    backBtn.setAttribute('aria-label', t.back);
                    backBtn.title = t.back;
                }
            }

            // Handle file uploads
            function handleFiles(files) {
                if (files.length > 0) {
                    const file = files[0];
                    const preview = document.getElementById('upload-preview');
                    const confirmBtn = document.getElementById('confirm-upload');
                    
                    // Show preview
                    preview.style.display = 'block';
                    preview.querySelector('.file-name').textContent = file.name;
                    preview.querySelector('.file-size').textContent = formatFileSize(file.size);
                    
                    // Enable upload button
                    confirmBtn.disabled = false;
                    
                    // Set up remove functionality
                    preview.querySelector('.remove-file').addEventListener('click', () => {
                        preview.style.display = 'none';
                        fileInput.value = '';
                        confirmBtn.disabled = true;
                    });
                    
                    // Set up confirm upload
                    confirmBtn.onclick = () => {
                        // In a real app, you would upload to a server
                        // For this prototype, we'll just simulate success
                        alert(`File "${file.name}" uploaded successfully!`);
                        closeUploadModal();
                        
                        // Add to materials grid (simulated)
                        addMaterialToGrid(file.name, formatFileSize(file.size));
                    };
                }
            }

            // Add material to grid (simulated)
            function addMaterialToGrid(name, size) {
                const materialsGrid = document.querySelector('.materials-grid');
                const newMaterial = document.createElement('div');
                newMaterial.className = 'material-card';
                newMaterial.innerHTML = `
                    <div class="material-thumbnail">
                        <img src="https://placeholder-image-service.onrender.com/image/120x120?prompt=document%20icon&id=material-new-1" alt="Uploaded document">
                    </div>
                    <div class="material-info">
                        <h4>${name.split('.')[0]}</h4>
                        <p>Uploaded learning material</p>
                        <div class="material-meta">
                            <span class="file-type">${name.split('.').pop().toUpperCase()}</span>
                            <span class="file-size">${size}</span>
                        </div>
                    </div>
                `;
                materialsGrid.appendChild(newMaterial);
            }

            // Format file size
            function formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                else return (bytes / 1048576).toFixed(1) + ' MB';
            }

            // Close upload modal
            function closeUploadModal() {
                uploadModal.style.display = 'none';
                document.getElementById('upload-preview').style.display = 'none';
                document.getElementById('confirm-upload').disabled = true;
                fileInput.value = '';
            }

            // Start a lesson
            function startLesson(lessonType) {
                dashboardScreen.classList.remove('active');
                gameScreen.classList.add('active');
                
                if (lessonType === 'math') {
                    document.getElementById('game-title').textContent = 'Math Puzzle Challenge';
                    document.getElementById('math-game-section').style.display = 'block';
                    document.getElementById('feedback-message').style.display = 'none';
                    document.getElementById('memory-game-section').style.display = 'none';
                    document.querySelector('.game-progress').style.display = 'block';
                    initMathGame();
                } else if (lessonType === 'memory') {
                    document.getElementById('game-title').textContent = 'Memory Match – Vocabulary';
                    document.getElementById('math-game-section').style.display = 'none';
                    document.getElementById('feedback-message').style.display = 'none';
                    document.getElementById('memory-game-section').style.display = 'block';
                    document.querySelector('.game-progress').style.display = 'none';
                    initMemoryGame();
                } else if (lessonType === 'science') {
                    // Science game would be implemented similarly
                    alert('Science quiz coming soon!');
                    dashboardScreen.classList.add('active');
                    gameScreen.classList.remove('active');
                }
            }

            // Initialize math game
            function initMathGame() {
                document.getElementById('game-points').textContent = userData.points;
                document.getElementById('problems-solved').textContent = '0';
                document.querySelector('.progress-fill').style.width = '0%';
                
                generateMathProblem();
            }

            // Generate a math problem
            function generateMathProblem() {
                feedbackMessage.style.display = 'none';
                mathAnswerInput.value = '';
                mathAnswerInput.focus();
                
                // Simple problem generation for prototype
                const a = Math.floor(Math.random() * 10) + 1;
                const b = Math.floor(Math.random() * 10) + 1;
                const c = a + b;
                
                document.getElementById('problem-text').textContent = `Solve: ${a} + ${b} = ?`;
                mathAnswerInput.dataset.expected = c;
            }

            // Check math answer
            function checkMathAnswer() {
                const userAnswer = parseInt(mathAnswerInput.value);
                const expectedAnswer = parseInt(mathAnswerInput.dataset.expected);
                const feedbackText = document.getElementById('feedback-text');
                
                if (isNaN(userAnswer)) {
                    feedbackText.textContent = 'Please enter a valid number!';
                    feedbackText.parentElement.style.color = '#ff4757';
                } else if (userAnswer === expectedAnswer) {
                    // Correct answer
                    userData.points += 10;
                    const problemsSolved = parseInt(document.getElementById('problems-solved').textContent) + 1;
                    document.getElementById('problems-solved').textContent = problemsSolved;
                    document.querySelector('.progress-fill').style.width = `${problemsSolved * 20}%`;
                    document.getElementById('game-points').textContent = userData.points;
                    
                    feedbackText.textContent = 'Correct! Great job! +10 points';
                    feedbackText.parentElement.style.color = '#2ed573';
                    
                    // Check if game completed
                    if (problemsSolved >= 5) {
                        feedbackText.textContent = 'Congratulations! You completed the math challenge!';
                        userData.mathProgress = 100;
                        userData.lessonsCompleted++;
                        awardBadge('math');
                    }
                } else {
                    // Wrong answer
                    feedbackText.textContent = `Incorrect. The answer is ${expectedAnswer}. Try again!`;
                    feedbackText.parentElement.style.color = '#ff4757';
                }
                
                feedbackMessage.style.display = 'block';
                saveUserData();
                updateDashboard();
            }

            // Award badge
            function awardBadge(type) {
                if (!userData.badges.includes(type)) {
                    userData.badges.push(type);
                    
                    // Unlock badge visually
                    const badgeElement = document.querySelector(`.badge.locked:nth-child(${type === 'math' ? 1 : type === 'science' ? 2 : type === 'tech' ? 3 : 4})`);
                    if (badgeElement) {
                        badgeElement.classList.remove('locked');
                    }
                }
            }

            // Update dashboard with current user data
            function updateDashboard() {
                document.getElementById('username').textContent = userData.username;
                document.getElementById('drawer-username').textContent = userData.username;
                document.getElementById('total-points').textContent = userData.points;
                document.getElementById('badges-count').textContent = userData.badges.length;
                document.getElementById('lessons-completed').textContent = userData.lessonsCompleted;
                
                // Update progress bars
                document.querySelector('[data-lesson="math"] .progress-fill').style.width = `${userData.mathProgress}%`;
                document.querySelector('[data-lesson="science"] .progress-fill').style.width = `${userData.scienceProgress}%`;
                const memoryProgressEl = document.querySelector('[data-lesson="memory"] .progress-fill');
                if (memoryProgressEl) memoryProgressEl.style.width = `${userData.memoryProgress || 0}%`;
                
                // Update badges
                userData.badges.forEach(badge => {
                    const badgeElement = document.querySelector(`.badge.locked:nth-child(${badge === 'math' ? 1 : badge === 'science' ? 2 : badge === 'tech' ? 3 : 4})`);
                    if (badgeElement) {
                        badgeElement.classList.remove('locked');
                    }
                });

                // Toggle Upload button visibility by role
                try {
                    const stored = localStorage.getItem('eduquest_user');
                    const parsed = stored ? JSON.parse(stored) : null;
                    const role = parsed && parsed.role ? parsed.role : 'student';
                    const uploadSectionBtn = document.getElementById('upload-btn');
                    const materialsSection = document.querySelector('.materials-section');
                    if (materialsSection) {
                        if (role === 'faculty') {
                            materialsSection.style.display = '';
                            if (uploadSectionBtn) uploadSectionBtn.style.display = '';
                        } else {
                            // hide entire materials section for students as requested
                            materialsSection.style.display = 'none';
                        }
                    }
                    // Student portal visible only for students
                    const studentPortal = document.getElementById('student-portal');
                    if (studentPortal) {
                        studentPortal.style.display = role === 'faculty' ? 'none' : '';
                    }
                } catch (e) {}
            }

            // ---------- Student Portal: Chart, Goals, Activity ----------
            let studentChart;
            function initStudentPortal() {
                const ctx = document.getElementById('student-progress-chart');
                if (ctx) {
                    const data = getSubjectScores();
                    studentChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Math', 'Science', 'English'],
                            datasets: [{
                                label: 'Score',
                                data: [data.math, data.science, data.english],
                                backgroundColor: ['#4a6fa5','#06d6a0','#ffd166']
                            }]
                        },
                        options: { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }
                    });
                }
                // Daily goals init
                loadDailyGoal();
                // Recent activity init
                renderRecentActivity();
                // Announcements
                renderStudentAnnouncements();
            }

            function getSubjectScores() {
                const store = JSON.parse(localStorage.getItem('eduquest_scores') || '{}');
                return { math: store.math || 0, science: store.science || 0, english: store.english || 0 };
            }
            function setSubjectScore(subject, value) {
                const store = JSON.parse(localStorage.getItem('eduquest_scores') || '{}');
                store[subject] = Math.max(0, Math.min(100, value));
                localStorage.setItem('eduquest_scores', JSON.stringify(store));
                if (studentChart) {
                    const idx = subject === 'math' ? 0 : subject === 'science' ? 1 : 2;
                    studentChart.data.datasets[0].data[idx] = store[subject];
                    studentChart.update();
                }
            }

            function loadDailyGoal() {
                const goal = JSON.parse(localStorage.getItem('eduquest_daily_goal') || 'null') || { target: 5, done: 0, text: 'Solve 5 problems today', date: new Date().toDateString() };
                // Reset if new day
                const today = new Date().toDateString();
                if (goal.date !== today) { goal.done = 0; goal.date = today; }
                document.getElementById('goal-text').textContent = goal.text;
                document.getElementById('daily-goal-target').textContent = goal.target;
                document.getElementById('daily-goal-done').textContent = goal.done;
                document.getElementById('daily-goal-fill').style.width = `${Math.min(100, (goal.done/goal.target)*100)}%`;
                localStorage.setItem('eduquest_daily_goal', JSON.stringify(goal));
            }
            function incrementDailyGoal(amount=1) {
                const goal = JSON.parse(localStorage.getItem('eduquest_daily_goal') || 'null') || { target: 5, done: 0, text: 'Solve 5 problems today', date: new Date().toDateString() };
                const today = new Date().toDateString();
                if (goal.date !== today) { goal.done = 0; goal.date = today; }
                goal.done += amount;
                localStorage.setItem('eduquest_daily_goal', JSON.stringify(goal));
                loadDailyGoal();
            }

            function logActivity(action, subject, details) {
                const list = JSON.parse(localStorage.getItem('eduquest_activity') || '[]');
                list.unshift({ ts: Date.now(), action, subject, details });
                localStorage.setItem('eduquest_activity', JSON.stringify(list.slice(0, 50)));
                renderRecentActivity();
            }
            function renderRecentActivity() {
                const list = JSON.parse(localStorage.getItem('eduquest_activity') || '[]');
                const ul = document.getElementById('recent-activity');
                if (!ul) return;
                ul.innerHTML = '';
                list.slice(0,10).forEach(item => {
                    const li = document.createElement('li');
                    const date = new Date(item.ts).toLocaleString();
                    li.textContent = `[${date}] ${item.subject}: ${item.action} — ${item.details}`;
                    ul.appendChild(li);
                });
            }

            function renderStudentAnnouncements() {
                const list = JSON.parse(localStorage.getItem('eduquest_announcements') || '[]');
                const ul = document.getElementById('student-announcements');
                if (!ul) return;
                ul.innerHTML = '';
                const myName = (JSON.parse(localStorage.getItem('eduquest_user')||'{}').username)||'';
                list.filter(a => a.audience === 'all' || (a.audience === 'student' && (!a.target || a.target === myName)))
                    .slice(-10).reverse()
                    .forEach(a => {
                        const li = document.createElement('li');
                        li.textContent = `${a.title}: ${a.message}`;
                        ul.appendChild(li);
                    });
            }

            // Memory Match Game
            const vocabularyPairs = [
                { id: 'amiable', front: 'Amiable', match: 'Friendly or pleasant' },
                { id: 'meticulous', front: 'Meticulous', match: 'Very careful and precise' },
                { id: 'innovate', front: 'Innovate', match: 'Introduce new ideas or methods' },
                { id: 'vivid', front: 'Vivid', match: 'Bright, clear, and detailed' },
                { id: 'empathy', front: 'Empathy', match: 'Understanding others’ feelings' },
                { id: 'resilient', front: 'Resilient', match: 'Able to recover quickly' },
                { id: 'chronology', front: 'Chronology', match: 'Order of events in time' },
                { id: 'artifact', front: 'Artifact', match: 'Object from the past made by people' },
                { id: 'habitat', front: 'Habitat', match: 'Natural home of an organism' },
                { id: 'perimeter', front: 'Perimeter', match: 'Distance around a shape' }
            ];

            let memoryState = {
                firstCard: null,
                lockBoard: false,
                moves: 0,
                matches: 0
            };

            function initMemoryGame() {
                memoryState = { firstCard: null, lockBoard: false, moves: 0, matches: 0 };
                document.getElementById('memory-moves').textContent = '0';
                document.getElementById('memory-matches').textContent = '0';
                document.getElementById('memory-complete').style.display = 'none';
                const grid = document.getElementById('memory-grid');
                grid.innerHTML = '';

                // Build deck: each pair turns into two cards, word and meaning
                const deck = [];
                vocabularyPairs.forEach(pair => {
                    deck.push({ key: pair.id, type: 'word', text: pair.front });
                    deck.push({ key: pair.id, type: 'def', text: pair.match });
                });
                // Shuffle
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
                // Render cards
                deck.forEach((card, idx) => {
                    const cardEl = document.createElement('button');
                    cardEl.className = `memory-card ${card.type === 'word' ? 'is-word' : 'is-def'}`;
                    cardEl.setAttribute('data-key', card.key);
                    cardEl.setAttribute('data-type', card.type);
                    cardEl.setAttribute('aria-label', 'Hidden card');
                    cardEl.setAttribute('role', 'gridcell');
                    cardEl.innerHTML = `<span class="card-front">${card.text}</span><span class="card-back">?</span>`;
                    cardEl.addEventListener('click', () => flipMemoryCard(cardEl));
                    grid.appendChild(cardEl);
                });

                document.getElementById('memory-restart').onclick = initMemoryGame;
            }

            function flipMemoryCard(cardEl) {
                if (memoryState.lockBoard || cardEl.classList.contains('matched') || cardEl === memoryState.firstCard) return;
                cardEl.classList.add('flipped');
                if (!memoryState.firstCard) {
                    memoryState.firstCard = cardEl;
                    return;
                }
                memoryState.moves++;
                document.getElementById('memory-moves').textContent = memoryState.moves.toString();
                const isMatch = cardEl.getAttribute('data-key') === memoryState.firstCard.getAttribute('data-key') &&
                                cardEl.getAttribute('data-type') !== memoryState.firstCard.getAttribute('data-type');
                if (isMatch) {
                    cardEl.classList.add('matched');
                    memoryState.firstCard.classList.add('matched');
                    memoryState.matches++;
                    document.getElementById('memory-matches').textContent = memoryState.matches.toString();
                    showMatchCheckmarkBetween(memoryState.firstCard, cardEl);
                    memoryState.firstCard = null;
                    if (memoryState.matches === vocabularyPairs.length) {
                        // Completed
                        userData.points += 20; // bonus for finishing
                        userData.memoryProgress = 100;
                        userData.lessonsCompleted++;
                        awardBadge('memory');
                        saveUserData();
                        updateDashboard();
                        const complete = document.getElementById('memory-complete');
                        complete.style.display = 'block';
                        document.getElementById('memory-feedback-text').textContent = `Great! You matched all pairs in ${memoryState.moves} moves. +20 points`;
                    }
                } else {
                    memoryState.lockBoard = true;
                    setTimeout(() => {
                        cardEl.classList.remove('flipped');
                        memoryState.firstCard.classList.remove('flipped');
                        memoryState.firstCard = null;
                        memoryState.lockBoard = false;
                    }, 800);
                }
            }

            function showMatchCheckmarkBetween(cardA, cardB) {
                const check = document.getElementById('match-checkmark');
                const rectA = cardA.getBoundingClientRect();
                const rectB = cardB.getBoundingClientRect();
                const midX = (rectA.left + rectA.right + rectB.left + rectB.right) / 4;
                const midY = (rectA.top + rectA.bottom + rectB.top + rectB.bottom) / 4;

                check.style.left = midX + 'px';
                check.style.top = midY + 'px';
                check.classList.add('show');
                setTimeout(() => check.classList.remove('show'), 600);
            }

            // Save user data to localStorage
            function saveUserData() {
                localStorage.setItem('eduquest_user', JSON.stringify(userData));
            }

            // Export user data as JSON file
            function exportUserData() {
                const dataStr = JSON.stringify(userData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'eduquest_progress.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }

            // Import user data from JSON file
            function importUserData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = e => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        try {
                            const importedData = JSON.parse(event.target.result);
                            userData = {...userData, ...importedData};
                            saveUserData();
                            updateDashboard();
                            alert('Progress data imported successfully!');
                        } catch (error) {
                            alert('Error importing file. Please make sure it is a valid EduQuest progress file.');
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            }

            // Initialize the app when DOM is loaded
            document.addEventListener('DOMContentLoaded', initApp);
        </script>
    <script>
        if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('service-worker.js').then(function(registration) {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }, function(err) {
            console.log('ServiceWorker registration failed: ', err);
            });
        });
        }
    </script>
    </body>
    </html>
